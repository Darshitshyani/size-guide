// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

// Note that some adapters may set a maximum length for the String type by default, please ensure your strings are long
// enough when changing adapters.
// See https://www.prisma.io/docs/orm/reference/prisma-schema-reference#string for more information
datasource db {
  provider = "sqlite"
  url      = "file:dev.sqlite"
}

model Session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String
  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)
  refreshToken        String?
  refreshTokenExpires DateTime?
}

model Template {
  id                 String   @id @default(uuid())
  shop               String   // Shop domain for multi-tenant support
  name               String   // Chart name (e.g., "Chart 4")
  gender             String   // "Male" or "Female"
  category           String   // Category ID (e.g., "pants", "shirts")
  columns            String   // JSON string storing column definitions
  rows               String   // JSON string storing row data
  guideImage         String?  // URL to measurement guide image
  measureDescription String?  // HTML description for measurements
  isActive           Boolean  @default(false)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  assignments ProductTemplateAssignment[]

  @@index([shop])
}

model ProductTemplateAssignment {
  id         String   @id @default(uuid())
  shop       String   // Shop domain
  productId  String   // Shopify product ID
  templateId String   // Reference to Template
  template   Template @relation(fields: [templateId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())

  @@unique([shop, productId]) // Each product can only have one template per shop
  @@index([shop])
  @@index([templateId])
}

// Custom Size Tailor Models
model TailorTemplate {
  id           String   @id @default(uuid())
  shop         String   // Shop domain for multi-tenant support
  name         String   // Template name (e.g., "Custom Kurta Measurements")
  gender       String   // "Male" or "Female"
  clothingType String   // "shirt", "pants", "kurta", "kurti", etc.
  fields       String   // JSON array of measurement field definitions
  fitPreferences String? // JSON object for fit preference settings (label, allowance)
  collarOptions  String? // JSON array for collar settings (name, image)
  enableStitchingNotes Boolean @default(false)
  customFeatures String? // JSON array for custom advanced features
  price        Float?   // Optional base price for custom order
  currency     String?  @default("USD") // Currency code for price
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  assignments TailorTemplateAssignment[]

  @@index([shop])
}

model TailorTemplateAssignment {
  id         String         @id @default(uuid())
  shop       String         // Shop domain
  productId  String         // Shopify product ID
  templateId String         // Reference to TailorTemplate
  template   TailorTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  createdAt  DateTime       @default(now())

  @@unique([shop, productId]) // Each product can only have one tailor template per shop
  @@index([shop])
  @@index([templateId])
}

// Size Chart Button Appearance Settings
model SizeChartSettings {
  id              String   @id @default(uuid())
  shop            String   @unique // One settings per shop
  
  // Button Settings
  buttonText      String   @default("Size Guide")
  buttonIcon      String   @default("ruler") // ruler, shirt, grid, info, hanger, none
  buttonAlignment String   @default("left") // left, center, right
  buttonTextColor String   @default("#ffffff")
  buttonBgColor   String   @default("#111111")
  buttonBorderRadius Int   @default(6)
  buttonPaddingTop    Int  @default(10)
  buttonPaddingBottom Int  @default(10)
  buttonPaddingLeft   Int  @default(20)
  buttonPaddingRight  Int  @default(20)
  buttonBorderStyle   String @default("none") // none, solid
  buttonBorderColor   String @default("#111111")
  buttonBorderWidth   Int    @default(1)
  buttonBorderTop     Boolean @default(true)
  buttonBorderRight   Boolean @default(true)
  buttonBorderBottom  Boolean @default(true)
  buttonBorderLeft    Boolean @default(true)
  
  // Table Settings
  tableDesign     String   @default("classic") // classic, minimal, striped, modern, elegant
  
  // Custom Order Button Settings
  customOrderButtonText      String   @default("Custom Order")
  customOrderButtonIcon      String   @default("ruler") // ruler, shirt, grid, info, hanger, none
  customOrderButtonTextColor String   @default("#ffffff")
  customOrderButtonBgColor   String   @default("#111111")
  customOrderButtonBorderRadius Int   @default(6)
  customOrderButtonBorderStyle   String @default("none") // none, solid, dashed, dotted
  customOrderButtonBorderColor   String @default("#111111")
  customOrderButtonBorderWidth   Int    @default(1)
  customOrderButtonBorderTop     Boolean @default(true)
  customOrderButtonBorderRight   Boolean @default(true)
  customOrderButtonBorderBottom  Boolean @default(true)
  customOrderButtonBorderLeft    Boolean @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([shop])
}

// Custom Order Status Tracking
model CustomOrderStatus {
  id              String   @id @default(uuid())
  shop            String   // Shop domain
  orderId         String   // Shopify order ID or temp ID
  orderName       String   // Order name (e.g., #1001 or Pending Order)
  lineItemId      String   // Line item ID within the order
  productId       String   // Product ID
  productTitle    String   // Product title
  productImage    String?  // Product image URL
  variantTitle    String?  // Variant title
  measurements    String   // JSON string of measurements
  options         String?  // JSON string of options (fit, collar, notes)
  status          String   @default("pending") // pending, accepted, rejected, dispatched
  notes           String?  // Internal notes
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([shop, orderId, lineItemId])
  @@index([shop])
  @@index([status])
}
